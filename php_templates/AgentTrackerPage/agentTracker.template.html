<div>
    <div class="page-header-container box">Agent Tracker Dashboard</div>

    <!-- Stats Cards -->
    <div class="page-body box">
        <div class="row" style="margin-bottom: 15px;">
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 8px;">
                    <div style="font-size: 28px; font-weight: bold;">{{stats.totalAgents}}</div>
                    <div>Total Agents</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 20px; border-radius: 8px;">
                    <div style="font-size: 28px; font-weight: bold;">{{stats.totalOnline}}</div>
                    <div>Online</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 20px; border-radius: 8px;">
                    <div style="font-size: 28px; font-weight: bold;">{{stats.totalOffline}}</div>
                    <div>Offline</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 20px; border-radius: 8px;">
                    <div style="font-size: 28px; font-weight: bold;">{{stats.onlinePercentage}}%</div>
                    <div>Online Rate</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bank Summary Cards -->
    <div class="page-body box" ng-show="!selectedBank">
        <div class="page-header-container" style="margin-bottom: 15px;">Banks Overview</div>
        <div class="row">
            <div class="col-md-3 col-sm-6" ng-repeat="bank in bankStats" style="margin-bottom: 15px;">
                <div class="bank-card" style="border: 1px solid #e5e7eb; border-left: 4px solid #667eea; border-radius: 8px; padding: 15px; cursor: pointer; background: #f9fafb;" ng-click="filterByBank(bank.bankcode)">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <strong>{{bank.bankcode}}</strong>
                        <span style="color: #6b7280;">{{bank.total}} agents</span>
                    </div>
                    <div style="display: flex; gap: 15px; margin-bottom: 8px;">
                        <span><span style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #10b981;"></span> {{bank.online}} Online</span>
                        <span><span style="display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: #ef4444;"></span> {{bank.offline}} Offline</span>
                    </div>
                    <div style="height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;">
                        <div style="height: 100%; background: linear-gradient(90deg, #10b981, #059669); border-radius: 3px;" ng-style="{'width': (bank.total > 0 ? (bank.online / bank.total * 100) : 0) + '%'}"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Agent Grid -->
    <div class="page-body box">
        <div class="button-container" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
            <div>
                <button type="button" class="btn btn-default btn-sm" ng-click="clearBankFilter()" ng-show="selectedBank">
                    <i class="fa fa-arrow-left"></i> Back
                </button>
                <span ng-show="selectedBank" style="margin-left: 10px; font-weight: bold;">{{selectedBank}} Agents</span>
                <span ng-show="!selectedBank" style="font-weight: bold;">All Agents</span>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <div class="btn-group">
                    <button type="button" class="btn btn-sm" ng-class="{'btn-primary': selectedFilter=='all', 'btn-default': selectedFilter!='all'}" ng-click="setFilter('all')">All ({{getFilterCount('all')}})</button>
                    <button type="button" class="btn btn-sm" ng-class="{'btn-success': selectedFilter=='online', 'btn-default': selectedFilter!='online'}" ng-click="setFilter('online')">Online ({{getFilterCount('online')}})</button>
                    <button type="button" class="btn btn-sm" ng-class="{'btn-danger': selectedFilter=='offline', 'btn-default': selectedFilter!='offline'}" ng-click="setFilter('offline')">Offline ({{getFilterCount('offline')}})</button>
                </div>
                <input type="text" class="form-control input-sm" placeholder="Search..." ng-model="searchTerm" ng-change="applyFilter()" style="width: 200px;">
                <button type="button" class="btn btn-default btn-sm" ng-click="refresh()" ng-disabled="gridIsLoading==true">
                    <i class="fa fa-refresh" ng-class="{'fa-spin': gridIsLoading}"></i> {{globallang.refresh}}
                </button>
            </div>
        </div>
        <div style="font-size: 12px; color: #6b7280; margin-bottom: 10px;">Last Updated: {{lastUpdate}}</div>
        <div id="grid1" ui-grid="gridOptions" class="grid" ui-grid-exporter style="height: 500px;">
            <div class="grid-nodata-container" ng-show="gridOptions.data.length == 0 && !gridIsLoading">No Data Available</div>
            <div class="grid-loading-container" ng-show="gridIsLoading">
                <img src="images/loading.gif" />
            </div>
        </div>
    </div>

    <!-- Agent Detail Modal -->
    <div class="modal-backdrop fade in" ng-show="showDetailModal" ng-click="closeDetailModal()"></div>
    <div class="modal fade in" tabindex="-1" role="dialog" ng-show="showDetailModal" style="display: block;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" ng-click="closeDetailModal()"><span>&times;</span></button>
                    <h4 class="modal-title">Agent Details</h4>
                </div>
                <div class="modal-body" ng-if="selectedAgent">
                    <div class="row">
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">USERNAME</label>
                            <div style="font-weight: 500;">{{selectedAgent.username}}</div>
                        </div>
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">ACCOUNT NO</label>
                            <div style="font-weight: 500;">{{selectedAgent.accountNo}}</div>
                        </div>
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">BANK CODE</label>
                            <div style="font-weight: 500;">{{selectedAgent.bankcode}}</div>
                        </div>
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">STATUS</label>
                            <div>
                                <span class="label" ng-class="{'label-success': selectedAgent.isOnline, 'label-danger': !selectedAgent.isOnline}">
                                    {{selectedAgent.isOnline ? 'ONLINE' : 'OFFLINE'}}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">CURRENT STATE</label>
                            <div><span class="badge" ng-class="getStateBadgeClass(selectedAgent.state)">{{selectedAgent.state || 'IDLE'}}</span></div>
                        </div>
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">LAST HEARTBEAT</label>
                            <div style="font-weight: 500;">{{selectedAgent.lastHeartbeat}}</div>
                        </div>
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">LAST TRX SUCCESS</label>
                            <div style="font-weight: 500;">{{selectedAgent.lastTransactionSuccess || 'N/A'}}</div>
                        </div>
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">LAST TRX ID</label>
                            <div style="font-weight: 500;">{{selectedAgent.lastTransactionId || 'N/A'}}</div>
                        </div>
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">LAST TRX AMOUNT</label>
                            <div style="font-weight: 500;">{{selectedAgent.lastTransactionAmount || 'N/A'}}</div>
                        </div>
                        <div class="col-md-6" style="margin-bottom: 15px;">
                            <label style="color: #6b7280; font-size: 12px;">TODAY'S TRANSACTIONS</label>
                            <div style="font-weight: 500;">{{selectedAgent.todayTransactionCount || 0}}</div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" ng-click="closeDetailModal()">Close</button>
                </div>
            </div>
        </div>
    </div>
</div>
